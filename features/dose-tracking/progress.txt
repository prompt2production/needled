---
Story: DOSE-001 Add doseNumber field to Injection model
Completed: 2026-01-24T10:30:00Z
Files changed: prisma/schema.prisma, prisma/migrations/20260124100000_add_session_and_notifications/migration.sql, prisma/migrations/20260124110000_add_dose_number/migration.sql
Notes: Added doseNumber Int @default(1) field to Injection model. Also created migration files to resolve drift from previous development (Session, NotificationPreference tables). Used db push + manual migration files due to migration drift.
---
---
Story: DOSE-002 Update injection validation schemas for doseNumber
Completed: 2026-01-24T10:53:00Z
Files changed: src/lib/validations/injection.ts, tests/unit/validations/injection.test.ts
Notes: Added doseNumberSchema and integrated it into both createInjectionSchema and updateInjectionSchema. Added comprehensive unit tests for valid (1-4) and invalid (0, 5, decimals, strings, negative) values.
---
---
Story: DOSE-003 Create dose calculation utility function
Completed: 2026-01-24T10:54:00Z
Files changed: src/lib/dose-tracking.ts, tests/unit/dose-tracking.test.ts
Notes: Created getNextDoseNumber function that cycles 1→2→3→4→1 (new pen). Handles null for first injection.
---
---
Story: DOSE-004 Update POST /api/injections to handle doseNumber
Completed: 2026-01-24T10:57:00Z
Files changed: src/app/api/injections/route.ts, tests/unit/api/injections.test.ts
Notes: Added doseNumber handling to POST. Auto-calculates from last injection if not provided. Added 7 new tests for doseNumber handling.
---
