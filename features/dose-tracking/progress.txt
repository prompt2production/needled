---
Story: DOSE-001 Add doseNumber field to Injection model
Completed: 2026-01-24T10:30:00Z
Files changed: prisma/schema.prisma, prisma/migrations/20260124100000_add_session_and_notifications/migration.sql, prisma/migrations/20260124110000_add_dose_number/migration.sql
Notes: Added doseNumber Int @default(1) field to Injection model. Also created migration files to resolve drift from previous development (Session, NotificationPreference tables). Used db push + manual migration files due to migration drift.
---
---
Story: DOSE-002 Update injection validation schemas for doseNumber
Completed: 2026-01-24T10:53:00Z
Files changed: src/lib/validations/injection.ts, tests/unit/validations/injection.test.ts
Notes: Added doseNumberSchema and integrated it into both createInjectionSchema and updateInjectionSchema. Added comprehensive unit tests for valid (1-4) and invalid (0, 5, decimals, strings, negative) values.
---
---
Story: DOSE-003 Create dose calculation utility function
Completed: 2026-01-24T10:54:00Z
Files changed: src/lib/dose-tracking.ts, tests/unit/dose-tracking.test.ts
Notes: Created getNextDoseNumber function that cycles 1→2→3→4→1 (new pen). Handles null for first injection.
---
---
Story: DOSE-004 Update POST /api/injections to handle doseNumber
Completed: 2026-01-24T10:57:00Z
Files changed: src/app/api/injections/route.ts, tests/unit/api/injections.test.ts
Notes: Added doseNumber handling to POST. Auto-calculates from last injection if not provided. Added 7 new tests for doseNumber handling.
---
---
Story: DOSE-005 Update PATCH /api/injections/[id] to handle doseNumber
Completed: 2026-01-24T10:58:00Z
Files changed: src/app/api/injections/[id]/route.ts, tests/unit/api/injections-id.test.ts
Notes: Added doseNumber to updateData in PATCH handler. Added 5 new tests for doseNumber update handling.
---
---
Story: DOSE-006 Update GET /api/injections/status to include dose information
Completed: 2026-01-24T11:00:00Z
Files changed: src/app/api/injections/status/route.ts, tests/unit/api/injections-status.test.ts
Notes: Added currentDose, nextDose, dosesRemaining to status response. Updated InjectionStatusResponse interface and added doseNumber to lastInjection. Added 9 new tests for dose tracking fields.
---
---
Story: DOSE-007 Update GET /api/injections to include doseNumber
Completed: 2026-01-24T11:02:00Z
Files changed: tests/unit/api/injections.test.ts
Notes: Prisma already returns doseNumber field with default of 1. Added 2 tests to verify doseNumber is included in GET response.
---
---
Story: DOSE-008 Create DoseSelector component
Completed: 2026-01-24T11:03:00Z
Files changed: src/components/injection/DoseSelector.tsx
Notes: Created DoseSelector with 4 horizontal buttons. Follows InjectionSiteSelector pattern for consistent styling. Uses lime styling for suggested/selected states.
---
---
Story: DOSE-009 Add DoseSelector to InjectionDialog
Completed: 2026-01-24T11:06:00Z
Files changed: src/components/injection/InjectionDialog.tsx, src/components/injection/InjectionCard.tsx, src/components/injection/InjectionCardConnected.tsx
Notes: Added DoseSelector below site selector. Updated onSubmit interface to include doseNumber. Default selection is suggestedDose. Updated InjectionCard and InjectionCardConnected to pass suggestedDose (from nextDose in status API).
---
---
Story: DOSE-010 Update InjectionCardConnected to pass dose information
Completed: 2026-01-24T11:08:00Z
Files changed: src/components/injection/InjectionCard.tsx, src/components/injection/InjectionCardConnected.tsx
Notes: Added currentDose and dosesRemaining props to InjectionCard. InjectionCardConnected now passes all dose tracking data from status API. Props are prefixed with underscore for now since they'll be used in DOSE-015.
---
---
Story: DOSE-011 Add DoseSelector to InjectionEditDialog
Completed: 2026-01-24T11:10:00Z
Files changed: src/components/injection/InjectionEditDialog.tsx, src/components/injection/InjectionHistory.tsx
Notes: Added DoseSelector to edit dialog. Initializes with existing injection's doseNumber. Updated Injection interface to include doseNumber. No suggestedDose prop passed for editing mode.
---
